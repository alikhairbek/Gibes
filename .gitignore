import os
import re

def extract_energies(file_content):
    # Initialize variables
    e0_g_corr = None

    # Regular expression for finding the required value
    e0_g_corr_pattern = re.compile(r'Sum of electronic and thermal Free Energies=\s+([-+]?\d+\.\d+)')

    # Extract values from the file content
    for line in file_content.splitlines():
        if e0_g_corr is None:
            e0_g_corr_match = e0_g_corr_pattern.search(line)
            if e0_g_corr_match:
                e0_g_corr = float(e0_g_corr_match.group(1))
                break

    return e0_g_corr

def calculate_gibbs_free_energies(filenames):
    hartree_to_kcal = 627.5095  # Conversion factor from Hartree to kcal/mol
    energies = {}
    for name in filenames:
        try:
            with open(f"{name}.log", 'r') as file:
                file_content = file.read()
            e0_g_corr = extract_energies(file_content)
            if e0_g_corr is None:
                raise ValueError(f"Missing data in {name}.log")
            total_energy = e0_g_corr * hartree_to_kcal  # Convert to kcal/mol
            energies[name] = total_energy
            print(f"{name}: Sum of electronic and thermal Free Energies = {e0_g_corr} Hartrees, Total = {total_energy} kcal/mol")
        except Exception as e:
            print(f"Error processing {name}.log: {e}")

    if len(energies) < len(filenames):
        raise ValueError("Not all files were processed correctly. Please check the errors above.")

    delta_g_RC = energies["RC"] - (energies["AC"] + energies["Azide"])
    delta_g_TS1 = energies["TS1"] - (energies["AC"] + energies["Azide"])
    delta_g_IC = energies["IC"] - (energies["AC"] + energies["Azide"])
    delta_g_TS2 = energies["TS2"] - (energies["AC"] + energies["Azide"])
    delta_g_P = energies["P"] - (energies["AC"] + energies["Azide"])

    return {
        "ΔrG∘(298K)RC": delta_g_RC,
        "ΔrG∘(298K)TS1": delta_g_TS1,
        "ΔrG∘(298K)IC": delta_g_IC,
        "ΔrG∘(298K)TS2": delta_g_TS2,
        "ΔrG∘(298K)P": delta_g_P,
    }

# Example usage
filenames = ["AC", "Azide", "RC", "TS1", "IC", "TS2", "P"]
try:
    gibbs_free_energies = calculate_gibbs_free_energies(filenames)
    for key, value in gibbs_free_energies.items():
        print(f"{key}: {value} kcal/mol")
except ValueError as e:
    print(e)
